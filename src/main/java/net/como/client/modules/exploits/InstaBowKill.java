package net.como.client.modules.exploits;

import net.como.client.ComoClient;
import net.como.client.events.StopUsingItemEvent;
import net.como.client.structures.Module;
import net.como.client.structures.events.Event;
import net.como.client.structures.settings.Setting;
import net.minecraft.client.network.ClientPlayNetworkHandler;
import net.minecraft.client.network.ClientPlayerEntity;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.ClientCommandC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;

public class InstaBowKill extends Module {
    public InstaBowKill() {
        super("InstaBowKill");
        this.description = "Kill anyone instantly with a bow";
        this.setCategory("Exploit");

        this.addSetting(new Setting("Multiplier", 100));
    }

    @Override
    public void activate() {
        this.addListen(StopUsingItemEvent.class);
    }

    @Override
    public void deactivate() {
        this.removeListen(StopUsingItemEvent.class);
    }

    @Override
    public void fireEvent(Event event) {
        switch (event.getClass().getSimpleName()) {
            case "StopUsingItemEvent": {
                StopUsingItemEvent e = (StopUsingItemEvent)event;
                
                ItemStack mainStack = e.playerEntity.getMainHandStack();
                if (!mainStack.getItem().equals(Items.BOW)) break;

                ClientPlayerEntity me = ComoClient.me();
                ClientPlayNetworkHandler networkHandler = me.networkHandler;
                networkHandler.sendPacket(new ClientCommandC2SPacket(me, ClientCommandC2SPacket.Mode.START_SPRINTING));

                for (int i = 0; i < this.getIntSetting("Multiplier"); i++) {
                    // First inaccuracy
                    networkHandler.sendPacket(
                        new PlayerMoveC2SPacket.PositionAndOnGround(me.getX(), me.getY() - 0.000000001, me.getZ(), true)
                    );

                    // Second inaccuracy
                    networkHandler.sendPacket(
                        new PlayerMoveC2SPacket.PositionAndOnGround(me.getX(), me.getY() + 0.000000001, me.getZ(), false)
                    );
                }

                break;
            }
        }
    }
}
